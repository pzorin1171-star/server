<!DOCTYPE html>
<html>
<head>
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</title>
    <style>
        body { font-family: Arial; text-align: center; margin: 50px; }
        .board { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; margin: 20px auto; width: 310px; }
        .cell { width: 100px; height: 100px; border: 2px solid #333; font-size: 40px; cursor: pointer; }
        #status { margin: 20px; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>üéÆ –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</h1>
    <div id="status">–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É...</div>
    <div class="board" id="board"></div>
    <div>URL –±—ç–∫–µ–Ω–¥–∞: <span id="backendUrl"></span></div>

    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ URL –±—ç–∫–µ–Ω–¥–∞
        const BACKEND_URL = window.location.origin;
        document.getElementById('backendUrl').textContent = BACKEND_URL;
        
        let socket = null;
        let currentSymbol = 'X';
        let board = Array(9).fill('');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            createBoard();
            connectToServer();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function createBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = board[i];
                cell.onclick = () => makeMove(i);
                boardElement.appendChild(cell);
            }
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
        function connectToServer() {
            socket = io(BACKEND_URL);
            
            socket.on('connect', () => {
                document.getElementById('status').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É!';
                document.getElementById('status').style.background = '#d4edda';
            });
            
            socket.on('connected', (data) => {
                console.log('Server:', data.message);
            });
            
            socket.on('move_made', (data) => {
                console.log('Move received:', data);
                if (data.index !== undefined) {
                    board[data.index] = data.symbol;
                    updateBoard();
                }
            });
            
            socket.on('disconnect', () => {
                document.getElementById('status').textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞';
                document.getElementById('status').style.background = '#f8d7da';
            });
        }

        // –•–æ–¥ –∏–≥—Ä–æ–∫–∞
        function makeMove(index) {
            if (board[index] === '') {
                board[index] = currentSymbol;
                updateBoard();
                
                if (socket) {
                    socket.emit('move', {
                        index: index,
                        symbol: currentSymbol
                    });
                }
                
                currentSymbol = currentSymbol === 'X' ? 'O' : 'X';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏
        function updateBoard() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                cell.textContent = board[index];
            });
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
    </script>
</body>
</html>
